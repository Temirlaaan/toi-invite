---
name: Event Builder & Media Upload
status: open
created: 2026-02-20T15:25:54Z
updated: 2026-02-20T15:48:31Z
github: https://github.com/Temirlaaan/toi-invite/issues/8
depends_on: [6]
parallel: false
conflicts_with: []
---

# Task: Event Builder & Media Upload

## Description
Build the invitation customization page where organizers select a template, fill in event details, upload media (photos, videos, music), customize colors, and see a live preview. Includes event CRUD API and auto-save.

## Acceptance Criteria
- [ ] "Create Event" flow: select template → name event → open builder
- [ ] Builder page (`/[locale]/dashboard/events/[id]/edit`) with form panels and live preview
- [ ] Form sections: event details (title, date, time, venue + coordinates, dress code), text content (kk/ru), color picker, media uploads
- [ ] Media upload to MinIO via presigned URLs (photos, videos, background music)
- [ ] Media gallery management (upload, reorder, delete)
- [ ] Live preview panel showing the invitation as guests would see it
- [ ] Auto-save drafts every 30 seconds (debounced)
- [ ] Event CRUD: create, read, update, delete via server actions
- [ ] Event list page in dashboard (`/[locale]/dashboard`) showing all user events with status badges
- [ ] File upload validation: max 10MB images, 50MB videos, 10MB audio; allowed types enforced

## Technical Details
- Builder is a client component (`"use client"`) with React state for customization data
- Preview panel renders the same template renderer used for guest pages (shared component)
- Media upload flow:
  1. Client requests presigned PUT URL from API route
  2. Client uploads directly to MinIO
  3. Client confirms upload → server creates Media record
- Event `customizationJson` stores all form data matching template `configJson` fields
- Venue coordinates: simple lat/lng input or paste from 2GIS/Yandex Maps URL (parse utility)
- Auto-save uses `useDebouncedCallback` to PATCH event via server action
- Dashboard event list: server component with Prisma query, sorted by updatedAt

## Dependencies
- [ ] Task 6: Template system and config format
- [ ] Task 2: MinIO configured and accessible

## Effort Estimate
- Size: L
- Hours: 20
- Parallel: false — guest page (Task 10) needs the builder data format
