---
name: Docker Deployment & Production Config
status: open
created: 2026-02-20T15:25:54Z
updated: 2026-02-20T15:48:31Z
github: https://github.com/Temirlaaan/toi-invite/issues/11
depends_on: [9]
parallel: false
conflicts_with: []
---

# Task: Docker Deployment & Production Config

## Description
Finalize the Docker deployment setup for production: optimized Dockerfile, production docker-compose, Nginx with SSL, environment management, health checks, and deployment documentation.

## Acceptance Criteria
- [ ] Multi-stage Dockerfile producing minimal standalone Next.js image (< 500MB)
- [ ] Production `docker-compose.prod.yml` with all services (app, postgres, minio, nginx)
- [ ] Nginx config with SSL (Let's Encrypt / certbot), gzip compression, static file caching, rate limiting
- [ ] Environment variable management: `.env.production.example` with all required vars documented
- [ ] Health check endpoints: `/api/health` returning app + db + minio status
- [ ] PostgreSQL data persistence via Docker volumes
- [ ] MinIO data persistence via Docker volumes
- [ ] Database migration runs automatically on container start (via entrypoint script)
- [ ] Restart policies configured for all services
- [ ] Deployment guide in project README: server requirements, setup steps, SSL config, backup strategy
- [ ] GitHub Actions workflow for building Docker image on push to main

## Technical Details
- Dockerfile stages: deps → build → runner (copy standalone output only)
- Entrypoint script: `docker/entrypoint.sh` — runs `npx prisma migrate deploy` then starts app
- Nginx config: `docker/nginx/nginx.conf` and `docker/nginx/ssl.conf`
- SSL: certbot container or manual cert placement in volume
- Health endpoint: `app/api/health/route.ts` — checks Prisma connection and MinIO bucket access
- docker-compose.prod.yml uses `restart: unless-stopped` for all services
- Volumes: `pg_data`, `minio_data` for persistence
- GitHub Actions: `.github/workflows/build.yml` — build + push Docker image to GitHub Container Registry

## Dependencies
- [ ] Task 9: All features polished and ready for production
- [ ] External: Production server with Docker installed
- [ ] External: Domain name configured with DNS

## Effort Estimate
- Size: M
- Hours: 8
- Parallel: false — final task, needs everything complete
